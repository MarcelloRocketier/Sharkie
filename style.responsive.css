@media (max-width: 992px){
  .nav { display: none; }

  #mobile-ctrl-left,
  #mobile-ctrl-right {
    display: block !important;
    z-index: 60;
  }

  #mobile-ctrl-left { bottom: 64px; left: 16px; position: fixed; }
  #mobile-ctrl-right { bottom: 64px; right: 16px; position: fixed; }

  .mobile-controller-container-left {
    position: fixed;
    bottom: 72px;
    left: 16px;
    z-index: 60;
    display: grid;
    grid-template-columns: auto auto auto;
    grid-template-rows: auto auto auto;
    grid-template-areas:
      ". up ."
      "left . right"
      ". down .";
    gap: 12px;
    align-items: center;
    justify-items: center;
  }

  .mobile-controller-container-left > :first-child {
    grid-area: up;
  }

  .mobile-controller-container-left > .mobile-controller-x-control {
    display: contents;
  }
  .mobile-controller-container-left > .mobile-controller-x-control > :first-child { grid-area: left; }
  .mobile-controller-container-left > .mobile-controller-x-control > :last-child  { grid-area: right; }

  .mobile-controller-container-left > :last-child {
    grid-area: down;
  }

  .mobile-controller-container-left .mobile-ctrl-btn {
    width: clamp(64px, 13vmin, 84px);
    height: clamp(64px, 13vmin, 84px);
  }

  .ctrl-arrow-img { width: 28px; height: auto; opacity: .95; }

  .mobile-controller-container-right {
    position: fixed;
    bottom: 72px;
    right: 16px;
    z-index: 60;
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
  }

  .mobile-controller-container-right .mobile-ctrl-btn {
    width: clamp(64px, 13vmin, 84px);
    height: clamp(64px, 13vmin, 84px);
  }

  .mobile-controller-container-left .mobile-ctrl-btn {
    width: clamp(56px, 12vmin, 72px);
    height: clamp(56px, 12vmin, 72px);
  }

  .ctrl-arrow-img { width: 26px; height: auto; opacity: .9; }
}

@media (hover: none) and (pointer: coarse) {
  /* Containers */
  #mobile-controls,
  #mobile-ctrl-left,
  #mobile-ctrl-right,
  .mobile-controller-container-left,
  .mobile-controller-container-right {
    display: block !important; 
    z-index: 60;
  }

  #ctrl-btn-up,
  #ctrl-btn-right,
  #ctrl-btn-down,
  #ctrl-btn-left,
  #ctrl-btn-fin-slap,
  #ctrl-btn-bubble-trap,
  #ctrl-btn-poison-bubble-trap {
    display: inline-flex !important;
  }

  #mobile-ctrl-left { position: fixed; bottom: 64px; left: 16px; }
  #mobile-ctrl-right { position: fixed; bottom: 64px; right: 16px; }
}

@media (orientation: portrait) and (max-width: 992px) {
  #landscape-message {
    display: flex !important;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 24px;
    font-size: clamp(18px, 5vw, 28px);
    line-height: 1.4;
    color: white;
    word-break: break-word;
  }
}

@media (max-width: 768px) {
  .game-title { font-size: 52px; }
  .start-screen-title { font-size: 48px; }
  .loading-text { font-size: 42px; }

  .btn {
    font-size: clamp(16px, 4vw, 28px);
    padding: 10px 16px;
  }

  .nav-btn, .close-btn {
    width: 48px;
    height: 48px;
    padding: 12px;
  }

  .nav-icon { width: 28px; height: 28px; }

  .mobile-controller-container-left {
    bottom: 24px;
    left: 16px;
    gap: 6px;
  }

  .mobile-controller-x-control { gap: 32px; }
}

@media (max-width: 576px) {
  .game-title { font-size: 36px; }
  .start-screen-title { font-size: 32px; }
  .loading-text { font-size: 28px; }

  .btn {
    font-size: clamp(14px, 4vw, 22px);
    padding: 8px 14px;
  }

  .nav-btn, .close-btn {
    width: 40px;
    height: 40px;
    padding: 10px;
  }

  .nav-icon { width: 24px; height: 24px; }

  .mobile-ctrl-btn {
    width: clamp(36px, 10vmin, 56px);
    height: clamp(36px, 10vmin, 56px);
  }

  .mobile-controller-x-control { gap: 24px; }
}

@media (hover: none) and (pointer: coarse) and (min-width: 820px) {

  .mobile-controller-container-left .mobile-ctrl-btn,
  .mobile-controller-container-right .mobile-ctrl-btn {
    width: 72px;              
    height: 72px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .ctrl-arrow-img {
    width: 30px;
    height: 30px;          
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    transform: translateZ(0);  
  }

  .mobile-controller-container-left { gap: 10px; }
  .mobile-controller-x-control { gap: 36px; }
}

/* === FEEDBACK FIX: Compact mobile controls layout === */
@media (hover: none) and (pointer: coarse) {
  /* Left: D‑Pad as 2x2 grid bottom-left */
  #mobile-ctrl-left {
    position: fixed;
    left: 12px;
    bottom: 16px;
    display: grid !important;
    grid-template-columns: 48px 48px;
    grid-template-rows: 48px 48px;
    gap: 8px;
    z-index: 60;
  }
  #ctrl-btn-up    { grid-column: 1 / 3; justify-self: center; }
  #ctrl-btn-left  { grid-column: 1; grid-row: 2; }
  #ctrl-btn-right { grid-column: 2; grid-row: 2; }
  #ctrl-btn-down  { grid-column: 1 / 3; grid-row: 3; justify-self: center; }

  /* Right: stacked vertically on right edge */
  #mobile-ctrl-right {
    position: fixed;
    right: 12px;
    bottom: 16px;
    display: flex !important;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
    z-index: 60;
  }

  /* Smaller buttons */
  .mobile-ctrl-btn {
    width: 48px !important;
    height: 48px !important;
  }
  .ctrl-arrow-img {
    width: 20px !important;
    height: 20px !important;
  }
}
/* === FIX: ensure D‑Pad grid mapping overrides earlier 3x3 template === */
@media (hover: none) and (pointer: coarse) {
  .mobile-controller-container-left {
    position: fixed;
    left: 12px;
    bottom: 16px;
    display: grid !important;
    grid-template-columns: 48px 48px !important;
    grid-template-rows: 48px 48px 48px !important; /* 3 rows so DOWN fits */
    grid-template-areas: none !important;
    gap: 8px !important;
    align-items: center;
    justify-items: center;
    z-index: 60;
  }
  /* neutralize older area mappings */
  .mobile-controller-container-left > :first-child,
  .mobile-controller-container-left > :last-child,
  .mobile-controller-container-left > .mobile-controller-x-control { grid-area: auto !important; }
  .mobile-controller-container-left > .mobile-controller-x-control { display: contents !important; }

  /* explicit placement for each control */
  #ctrl-btn-up    { grid-column: 1 / 3 !important; grid-row: 1 !important; justify-self: center; }
  #ctrl-btn-left  { grid-column: 1 !important; grid-row: 2 !important; }
  #ctrl-btn-right { grid-column: 2 !important; grid-row: 2 !important; }
  #ctrl-btn-down  { grid-column: 1 / 3 !important; grid-row: 3 !important; justify-self: center; }

  /* compact sizes */
  .mobile-ctrl-btn { width: 48px !important; height: 48px !important; }
  .ctrl-arrow-img { width: 20px !important; height: 20px !important; }

  /* right actions: vertical stack at edge */
  .mobile-controller-container-right {
    position: fixed; right: 12px; bottom: 16px;
    display: flex !important; flex-direction: column; gap: 8px; align-items: flex-end;
  }
}
/* === FINAL TUNE: precise sizing/centering for mobile controls === */
@media (hover: none) and (pointer: coarse) {
  :root {
    --ctrl-size: clamp(44px, 9vmin, 56px);
    --ctrl-gap: clamp(6px, 1.6vmin, 10px);
    --ctrl-margin: clamp(10px, 2vmin, 16px);
  }

  /* Left D‑Pad placement (wins over earlier rules) */
  #mobile-ctrl-left {
    left: var(--ctrl-margin) !important;
    bottom: var(--ctrl-margin) !important;
    grid-template-columns: var(--ctrl-size) var(--ctrl-size) !important;
    grid-template-rows: var(--ctrl-size) var(--ctrl-size) var(--ctrl-size) !important;
    gap: var(--ctrl-gap) !important;
  }

  /* Right action stack placement */
  #mobile-ctrl-right,
  .mobile-controller-container-right {
    right: var(--ctrl-margin) !important;
    bottom: var(--ctrl-margin) !important;
    gap: var(--ctrl-gap) !important;
  }

  /* Button box and icon centering */
  .mobile-ctrl-btn {
    width: var(--ctrl-size) !important;
    height: var(--ctrl-size) !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  .ctrl-arrow-img {
    width: calc(var(--ctrl-size) * 0.42) !important;
    height: calc(var(--ctrl-size) * 0.42) !important;
  }
}

/* Slightly larger on big tablets, still compact */
@media (hover: none) and (pointer: coarse) and (min-width: 1024px) {
  :root {
    --ctrl-size: clamp(48px, 6vmin, 60px);
    --ctrl-gap: clamp(8px, 1.4vmin, 12px);
    --ctrl-margin: clamp(12px, 1.8vmin, 18px);
  }
}